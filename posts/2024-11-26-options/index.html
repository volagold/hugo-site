<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Options Trading and the Black-Scholes Model | lifei.ai | AI blogs</title><meta name=keywords content="tag"><meta name=description content="Basics An option is a financial contract that gives you the right (but not obligation) to buy or sell usually 100 shares of the underlying asset at a strike price $X$ at or before some specific date, usually Fridays. The price of an option is quoted on a per share basis, for example 5.5 USD. To buy the option, you have to pay 5.5 x 100 = 550 USD. If the option later rises to 6."><meta name=author content="Fei Li"><link rel=canonical href=https://lifei.ai/posts/2024-11-26-options/><link crossorigin=anonymous href=/assets/css/stylesheet.415e3a8d51db2ff1dd1daeb6ed47da1d29ea7215172df9a95da9a546c6c5ba84.css integrity="sha256-QV46jVHbL/HdHa627UfaHSnqchUXLfmpXamlRsbFuoQ=" rel="preload stylesheet" as=style><link rel=icon href=https://lifei.ai/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://lifei.ai/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://lifei.ai/favicon-32x32.png><link rel=apple-touch-icon href=https://lifei.ai/apple-touch-icon.png><link rel=mask-icon href=https://lifei.ai/apple-touch-icon.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><link rel=stylesheet type=text/css href=/hugo-cite.css><script src=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.4/katex.min.js integrity="sha512-sHSNLECRJSK+BFs7E8DiFc6pf6n90bLI85Emiw1jhreduZhK3VXgq9l4kAt9eTIHYAcuQBKHL01QKs4/3Xgl8g==" crossorigin=anonymous referrerpolicy=no-referrer></script>
<link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.4/katex.min.css integrity="sha512-mQwom8Ns4op+H29oDkD/LXO/OsXPvCFfkgZkFAVrhhePzRLU8NUI3Nkm43NhWUSmj3p5Cca2HTEkMQmXQRwDQQ==" crossorigin=anonymous referrerpolicy=no-referrer><script src=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.4/contrib/auto-render.min.js integrity="sha512-iWiuBS5nt6r60fCz26Nd0Zqe0nbk1ZTIQbl3Kv7kYsX+yKMUFHzjaH2+AnM6vp2Xs+gNmaBAVWJjSmuPw76Efg==" crossorigin=anonymous referrerpolicy=no-referrer onload=renderMathInElement(document.body)></script>
<script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}]})})</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-QV43D2GXK2"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-QV43D2GXK2",{anonymize_ip:!1})}</script><meta property="og:title" content="Options Trading and the Black-Scholes Model"><meta property="og:description" content="Basics An option is a financial contract that gives you the right (but not obligation) to buy or sell usually 100 shares of the underlying asset at a strike price $X$ at or before some specific date, usually Fridays. The price of an option is quoted on a per share basis, for example 5.5 USD. To buy the option, you have to pay 5.5 x 100 = 550 USD. If the option later rises to 6."><meta property="og:type" content="article"><meta property="og:url" content="https://lifei.ai/posts/2024-11-26-options/"><meta property="og:image" content="https://lifei.ai/imgs/opt/cover.jpg"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-11-26T00:00:00+00:00"><meta property="article:modified_time" content="2024-11-26T00:00:00+00:00"><meta property="og:site_name" content="lifei.ai | AI blogs"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://lifei.ai/imgs/opt/cover.jpg"><meta name=twitter:title content="Options Trading and the Black-Scholes Model"><meta name=twitter:description content="Basics An option is a financial contract that gives you the right (but not obligation) to buy or sell usually 100 shares of the underlying asset at a strike price $X$ at or before some specific date, usually Fridays. The price of an option is quoted on a per share basis, for example 5.5 USD. To buy the option, you have to pay 5.5 x 100 = 550 USD. If the option later rises to 6."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://lifei.ai/posts/"},{"@type":"ListItem","position":2,"name":"Options Trading and the Black-Scholes Model","item":"https://lifei.ai/posts/2024-11-26-options/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Options Trading and the Black-Scholes Model","name":"Options Trading and the Black-Scholes Model","description":"Basics An option is a financial contract that gives you the right (but not obligation) to buy or sell usually 100 shares of the underlying asset at a strike price $X$ at or before some specific date, usually Fridays. The price of an option is quoted on a per share basis, for example 5.5 USD. To buy the option, you have to pay 5.5 x 100 = 550 USD. If the option later rises to 6.","keywords":["tag"],"articleBody":"Basics An option is a financial contract that gives you the right (but not obligation) to buy or sell usually 100 shares of the underlying asset at a strike price $X$ at or before some specific date, usually Fridays. The price of an option is quoted on a per share basis, for example 5.5 USD. To buy the option, you have to pay 5.5 x 100 = 550 USD. If the option later rises to 6.0 USD, you can sell the option and get a profit of (6-5.5) x 100 = 50 USD. For convenience, in this post we will omit the multiplier and hold our discussions on a per share basis.\nThe most traded stock and ETF options in the US market are those for SPY, QQQ, Tesla, Nvidia, among others. There can be other types of options, for example options on index and futures. For convenience, we will use the word “stock” to refer to the underlying asset. We will use the following notations unless otherwise stated.\n$X$ for strike price; $T$ for expiration date; $s$ or $s_T$ for stock price; $P$ for option price. There are two types of options: call options and put options.\nA call option is a contract that gives you the right to purchase 100 shares of some stock at or before expiration date $T$. At expiration,\nprofit to long position is $v(s_T)=\\max(0,s_T-X)-P$. Maximum profit is $+\\infty$. profit to short position is $-v(s_T)=\\min(0,X-s_T)+P$. Maximum loss is $-\\infty$. A put option is a contract that gives you the right to sell 100 shares of some stock at or before expiration date $T$. At expiration,\nprofit to long position is $v(s_T) = \\max(0,X-s_T)-P$. Maximum profit is $X-P$ when the stock price drops to zero. profit to short position is $-v(s_T) = \\min(0,s_T-X) + P$. Maximum loss is $P-X$. An option is in-the-money (ITM) if the current stock price is above (for call) or below (for put) the strike price, so that exercising the option now can generate a positive payoff. It is out-of-the-money (OTM) if the reverse situation is true, so that it is temporarily not profitable to exercise the option. It is at-the-money (ATM) if the stock price is equal to the strike price. In practice, this moneyness concept is very important to keep in mind for selecting the right options and constructing trading strategies.\nThe price of a option consists of two parts: time value and intrinsic value.\nthe intrinsic value is the difference between current stock price and strike price if it is in-the-money, and 0 otherwise. the time value is option price minus the intrinsic value, namely the remaining part in the option price. Even though you cannot profit from an OTM call contract by exercising the option, the stock price has the possibility to rise up beyond the strike price in the future and make the contract profitable. For this reason, all types of options including OTM ones are bought and sold with positive premiums.\nWhen you buy an option and exercise it, you can only get its intrinsic value, but not its time value. Further, you have to prepare adequate cash or stocks needed for settlement, and can incur transaction fees. For this reason, you typically close your position by selling the option, instead of exercising it. On the other hand, for option sellers (or writers), because such possibility exists, you are required to maintain a good amount of margin. If the price of the option you sold continues to rise, you margin may become inadequate, and you may receive a margin call.\nOption trading is a zero-sum game. The money you earned from trading options must come from somebody else’s pocket. At the same time, option is a financial derivative that can be used to hedge risks. Together with other derivatives like futures and swaps, they are part of modern risk management toolbox. By trading stocks and options, traders provide liquidity to the financial market and help discover fair asset prices. Now let’s discuss some most commonly used option trading strategies in practice.\nTrading Strategies protective put (pp) Suppose you bought some company’s stocks at price $s_0$, in hope that your can sell the stock at a higher price $s_T$ in the future. To protect yourself against unexpected price drops, you can spend $-P$ to buy put options on that stock as a kind of insurance. Suppose the strike price $X$ is equal to $s_0$.\nAt the end of period, if the price goes up, you obtain gains with initial spending of $-P$. If price goes down, let’s say to 0, you can exercise the put and close your stock position at initial price $s_0$, protecting you from losing all the investments ($s_0$ times quantity).\nBy definition, your pp profit at $T$ is equal to stock profit $(s_T-s_0)$ ➕ put option profit: $$ (s_T - s_0) + \\bigg(\\max(0, X-s_T)-P_{\\text{put}}\\bigg) = \\max(X,s_T)-P_{\\text{put}}-s_0. $$\nSince $\\max(X, s_T) - X = \\max(0, s_T-X)$, in the case $X\\equiv s_0$, protective put is similar to buying a call option with the same strike price. The difference is that the down payment is the price of a put $P_{\\text{put}}$, instead of a call $P_{\\text{call}}$.\ncovered call (cc) A covered call is a situation where you sell call contracts with underlying stocks at your deposit. Typically, you are a long-term shareholder of a company, say Nvidia. A covered call lets you profit from short-term price drops and weak movements.\nIf the price unexpectedly goes up, you give away your stock at strike price $X$ instead of the more lucrative price $s_T$, capping your profit at $(X-s_0) + P$. If the price goes down, you will be safe with the premium from selling the call. Although your stock value will decrease on paper, you are optimistic about the company in the long-term and thus will not sell your stocks. Mathematically, the profit at end period $T$ is equal to the sum of profit from long position on stocks and short position on calls\n$$ (s_T -s_0) + \\bigg(\\min(0,X-s_T)+P_{\\text{call}}\\bigg) = \\min(X, s_T) + P_{\\text{call}} - s_0 $$\nSince $\\min(X, s_T) - X = \\min(0, s_T-X)$, in the case $X\\equiv s_0$, covered call is similar to selling a put option with the same strike price. The difference is that the premium comes from selling a call $P_{\\text{call}}$, instead of a put $P_{\\text{put}}$.\nIn strategies like covered call, you can further use rolling to adjust your positions. Rolling refers to closing your short position on the derivative (i.e. buy back) and then open a different one. For covered call strategy, there are three cases:\nrolling-up: when stock price goes up, unfavorably for your short position on the call, if you still assume limited possibility for a large hike, you can close your current position (with possible losses) and sell a call with a higher strike price $X$, hoping that price will not go that high. rolling-down: when stock price goes down, maybe the contract you sold already lost most of its value, so you can close your position and substitute it with a lower-strike call, to protect your stocks and increase your premium income. rolling-forward: when the contract you sold is soon to expire, you can substitute it with a distant one. Quiz. Why it may not be a good idea to sell a put option, regardless of whether you have long position or short position of the underlying stock? Draw the profit graph in each case.\nstraddle A straddle is one put plus one call with the same strike $X$ and expiration $T$, with V-shaped profit curve. It will profit when price have large moves in the future, no matter its direction. It is a bet on volatility.\nBe cautious when using this strategy before major events like earnings release. When large volatility is a consensus, it will be priced into the options. With such expensive prices, the actual volatility has to go even further beyond current expectation for you to profit. Otherwise, you may never come out of the V-shape valley.\nThat’s long straddle. Conversely, you can also short the straddle, betting that the stock price will not have significant movements. The profit curve is a flipped V.\nstrangle strangle is similar to straddle, but with buying a put and a call with different strike prices $X_1$ and $X_2$. Typically, they are all out-of-money options, namely $X_1 \u003c s \u003c X_2$, so they are cheaper, but it requires greater volatility to profit.\nvertical spread A vertical spread is simultaneous purchase and sale of the same kind of option (either two calls or two puts) with same expiration $T$ but different strike prices $X_1$ and $X_2$. It can reduce the premium you have to pay while also cap profits.\nWhen you expect the stock market to rise slowly in the future, you can establish a vertical spread using either calls or puts. The two approaches’ profit curves share the same shape.\nBull call spread / call debit spread. you can buy a call with lower $X_1$ (expensive) and sell a call with higher $X_2$ (cheaper). Bull put spread / put credit spread. you can buy a put with lower $X_1$ (cheaper) and sell a put with higher $X_2$ (expensive). a collar is buy stocks, buy put, and sell call with a high strike price. Since protective put (pp) is similar to buying a call, we see that collar is similar to a bull call spread.\nConversely, when you expect the stock market to fall slowly in the future, you can establish a bear spread by reversing the strategies above.\nBear call spread / call credit spread. you can sell a call with lower $X_1$ (expensive) and buy a call with higher $X_2$ (cheaper). Bear put spread / put debit spread. you can sell a put with lower $X_1$ (cheaper) and buy a put with higher $X_2$ (expensive). calendar spread The time value of a short period option decays fast, especially when price often moves in the unfavorable direction. A calendar spread involves buying a distant option ($T_2$) and selling a short period one ($T_1$) with the same strike price, to capture the time value of the short period option. The option can be either call or put. Both have a similar profit curve.\nThe plot below shows our profit standing at time $T_1$, when the time value for the short-period option expires but longer-period option’s time value still exists.\nbutterfly The butterfly strategy, along with the condor strategy below, are strategies that profit from minimal movement in the underlying stock price. It can be implemented using either 4 calls or 4 puts, and typically involves three options with three strike prices $X-a$, $X=s_0$, and $X+a$. Using call option as an example, it consists of:\nbuying 1 in-the-money call with strike $X-a$ selling 2 at-the-money call with strike $X = s_0$ buying 1 out-of-money call with strike $X+a$. You sell 2 at-the-money calls betting price will stay flat. You buy ITM and OTM calls to cap your loss in case the stock price has unexpected large fluctuations.\niron butterfly In the butterfly strategy you trade 4 options of the same type. Iron butterfly uses a mix of 2 puts and 2 calls. You typically short an iron butterfly to capture ATM options’ time values when price is stable. A short iron butterfly can consist of\nbuying 1 out-of-money put with strike $X - a$ selling 1 at-the-money put with strike $X$ selling 1 at-the-money call with strike $X$ buying 1 out-the-money call with strike $X + a$ The profit curve shape for short iron butterfly is the same as butterfly above.\ncondor Condor is similar to butterfly. While in butterfly you sell 2 options with identical strike price, in condor you sell 2 options with different strike prices. This allows you to capture a wider range of potential values, but has a higher premium and therefore a lower maximum profit.\nAgain using call option as an example, with $X_1 \u003c X_2$, it consists of\nbuying call1 with strike $X_1-a$ selling call2 with strike $X_1$ selling call3 with strike $X_2$ buying call4 with strike $X_2+a$. iron condor Similar to short iron butterfly, the short iron condor strategy captures option time value lost from stable price movement over time from selling one put and one call near current price, then cover the position with OTM put and call. With $X_1 \u003c X_2$, it consists of\nbuying 1 out-of-money put with strike $X_1 - a$ selling 1 at-the-money put with strike $X_1$ selling 1 at-the-money call with strike $X_2$ buying 1 out-the-money call with strike $X_2 + a$ Quiz. Draw each strategy’s profit curve according to their definitions, as shown above, using Python or any programming language that you’re comfortable with.\nPut-call parity relationship Put options and call options are clearly related. For example, we saw earlier that the profit curve for protective put (pp) is similar to that of a call option, and the profit curve for covered call (cc) is similar to shorting a put option. Let’s now add risk-free rate into the equation and derive their relationship.\nConsider portfolio A that consists of a call with strike $X$ and risk-free zero-­coupon bond with face value $X$. At the end of period $T$,\nif $s_T \\leq X$, the portfolio’s payoff is $0 + X = X$ if $s_T \u003e X$, the portfolio’s payoff is $(s_T - X) + X = s_T$ Now consider portfolio B of a protective put (pp), which consists of stock $s$ and put option with strike $X$. The payoff at $T$ is:\nif $s_T \\leq X$, the portfolio’s payoff is $(X - s_T) + s_T = X$ if $s_T \u003e X$, the portfolio’s payoff is $0 + s_T = s_T$ Therefore, the two portfolio’s payoffs are the same, so their costs (or prices) must be identical as well. Let us denote the call option price as $P_{\\text{call}}$, put option price as $P_{\\text{put}}$ , and noting that the risk-free bond is worth $X / (1 + r)^T$ today, we have\n$$ P_{\\text{call}} + \\frac{X}{(1+r)^T} = P_{\\text{put}} + s_0 $$\nThis is the put-call parity relationship. More generally,\n$$ P_{\\text{put}} = P_{\\text{call}} - s_0 + \\mathrm{PV}(X) + \\mathrm{PV}(\\text{dividends}) $$\nThe put-call parity relationship can be used to derive corresponding put option price once we have calculated call option price for the same strike price, and vice versa.\nOption prices depend on several factors, including the stock price, strike price, volatility, expiration date, risk-free rate, and dividends. Among them, the most crucial one is the volatility of the stock. The more volatile a stock is, the more likely it is to hit some strike price somewhere in the future and make such options profitable. For this reason, for stocks that have high variances, their options are typically more expensive. Once volatility crushed, e.g. after earnings, near-expiration OTM option prices typically will also collapse.\nAnother important factor is time. Longer periods allow more room for price movement, so distant date options are more expensive than nearer ones. Timing is extremely important for option trading. You might successfully predict that some stock will go up in the future. But when? At what point should you open your position? Option prices can vary greatly from day to day. Being able to predict the general trend does not guarantee profits.\nNow we discuss two most well-known option pricing models, the binomial options pricing model and its continuous variant, the Black-Scholes model ( Citation: Black \u0026 Scholes, 1973 Black, F. \u0026 Scholes, M. (1973). The pricing of options and corporate liabilities. Journal of political economy, 81(3). 637–654. ) . The idea behind the two and many other pricing models is replication, namely constructing a portfolio with identical payoff, and pricing the option as the portfolio’s cost.\nThe binomial options pricing model Let’s start with an example. Suppose the stock price now is $s_0=100$, and suppose after one period there’re two scenarios with equal probability: the stock price either goes up by $u=1.2$ to $120$, or goes down by $d=0.9$ to $90$.\n100 / \\ 90 120 A call option with price $P$ and strike $X=110$ will have the following payoff:\nP / \\ 0 10 To replicate the payoff, suppose interest rate $r$ is $0.1$. We use leverage and put in $18.18$ and borrow $90 / (1 + r) = 81.82$ for a total of $100$ dollars and buy one share of stock. After one period we sell the stock and pay back the loan. The return is either $0$ or $30$.\n18.18 / \\ 0 30 The payoff is 3 times the call option’s payoff, so the portfolio’s cost must also equal to 3 times the option’s price:\n$3P = 18.18 \\Longrightarrow P = 6.06$.\nThis is how the binomial model prices options in essence. Now let’s generalize. We divide $T=1$ into $n$ periods, where stock price can go up by $u$ with probability $p$ or go down by $d$ with probability $(1-p)$ in each period. Each possible final price $s_T$ corresponds to a sequence of experiments:\n$$ \\text{trial} = (u, u, d, \\ldots, u)\\quad\\Rightarrow\\quad s_T = u^kd^{n-k}\\cdot s_0 $$\nThe value of a call option in period $n$ depends on stock price $s_T$. Different trials lead to different $s_T$. The probability of each trial can be described by binomial distribution that assigns probability $\\mathbb{P}(k)$ to $k$ successes for each $k=0,\\ldots,n$ :\n$$ \\mathbb{P}(k) = \\binom{n}{k}p^k(1-p)^{n-k}. $$\nIn the example above, we set some arbitrary values for $u$, $d$ and $p$, but in general they should depend on volatility of the stock price, $\\sigma$. One way is to set\n$$ u = e^{\\sigma\\sqrt{\\Delta t}}, \\quad d = e^{-\\sigma\\sqrt{\\Delta t}} $$\nwhere $\\Delta t = T/n$. For $p$, we use the risk-neutral probability trick: since option pricing is independent from risk attitude, we can posit everyone to be risk-neutral, so that no other returns but only risk-free rate $r$ is preferred. This means $\\mathbb{E}(s)$ should be $(1+r\\Delta t)\\cdot s$ :\n$$ p\\cdot uS+(1-p)\\cdot dS = (1+r\\Delta t)S \\quad\\Rightarrow\\quad p = \\frac{1+r\\Delta t-d}{u-d} $$ In this risk-neutral world, the value of the call today is its expected value in the next period discounted by risk-free rate. With this, we can start from the final nodes where $P_T = (s_T - X)^+$ and work backwards to get values at previous nodes, all the way to the root $P_0$. $$ P_i = \\frac{p\\cdot P_{i+1,u}+(1-p)\\cdot P_{i+1,d}}{1+r\\Delta t} $$ For $n$ large, $e^{r\\Delta t}\\approx1+r\\Delta t$ so we can substitute the discount term with $e^{r\\Delta t}$​.\nHere is a Python implementation.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 import math def binomial_option_pricing(s0, X, r, T, sigma, n, typ='call'): dt = T / n # time delta u = math.exp(sigma * math.sqrt(dt)) # up factor d = 1 / u # down factor p = (math.exp(r * dt) - d) / (u - d) # risk-neutral probability # 1.create a tree to store stock prices and option values stock_prices = [[0] * (i + 1) for i in range(n + 1)] option_values = [[0] * (i + 1) for i in range(n + 1)] # 2.initialize the final node values based on option type for k in range(n + 1): stock_prices[n][k] = u**k * d**(n - k) * s0 if typ == 'call': option_values[n][k] = max(0, stock_prices[n][k] - X) else: option_values[n][k] = max(0, X - stock_prices[n][k]) # 3.calculate option values for earlier nodes for t in range(n - 1, -1, -1): for i in range(t + 1): option_values[t][i] = math.exp(-r * dt) * (p * option_values[t + 1][i + 1] + (1 - p) * option_values[t + 1][i]) return option_values[0][0] Example usage:\n1 2 3 4 5 6 7 8 9 s0 = 100; X = 105; r = 0.05; T = 0.1; sigma = 0.2; n = 100 call_price = binomial_option_pricing(s0, X, r, T, sigma, n, typ='call') put_price = binomial_option_pricing(s0, X, r, T, sigma, n, typ='put') print(\"call option price:\", round(call_price, 2)) print(\"put option price:\", round(put_price, 2)) # call option price: 0.93 # put option price: 5.41 We observe that in binomial option pricing model, as each step is either up or down, going many steps is like going through a random walk. More precisely, since it is multiplicative: $$ u\\cdot u\\cdot u\\cdot d\\cdot d\\cdot u\\cdot u\\cdot d\\cdots $$ the log of the above sequence is an additive random walk. In the limit as $n\\to\\infty$, the additive random walk approaches (the continuous) Brownian motion, so that the original multiplicative process approaches geometric brownian motion. This means in particular that the distribution of the stock price at expiration progressively approaches the lognormal distribution.\nThe Black-Scholes model The Black-Scholes model is the continuous limit of the binomial pricing model as we divide $T$ into smaller and smaller periods. It is described by a stochastic PDE. We first discuss the solution to the PDE, the Black-Scholes formula, then derive the PDE and its solution later in the post.\nThe Black-Scholes formula With $$ d_{1,2} = \\frac{\\log(e^{rT}s_0/X)}{\\sigma\\sqrt{T}} \\pm \\frac{1}{2}\\sigma\\sqrt{T} $$ and $N(x)$ as the CDF of standard normal: $$ N(x) = \\frac{1}{\\sqrt{2\\pi}}\\int_{-\\infty}^xe^{-t^2/2}dt, $$ the Black-Scholes formula for call option is $$ \\begin{equation} \\boxed{P_\\text{call} = s_0\\cdot N(d_1) - e^{-rT}X\\cdot N(d_2)} \\end{equation} $$\nThis is for $t=0$. For $0 \u003c t \u003c T$, substitute $T$ with $T-t$ and $s_0$ with $s_t$. Put option price can be derived using the put-call parity relationship $$ \\begin{equation} P_\\text{put} = P_\\text{call} - s_0 + e^{-rT}X. \\end{equation} $$\nThe first important concept is implied volatility (IV). In Black-Scholes model, volatility is treated as a constant. In practice, with a given price quote for an option, we can work backwards and derive the volatility constant perceived by the market. This is called implied volatility (IV). IV and price go hand in hand. Their relationship is almost linear.\nIn major events like earnings release, people anticipate large price movements, and such expectations are often priced into the options. As we can see below, even though Meta’s Q3 2024 financials didn’t meet investors’ expectations and its price suffered a large drop in the next trading day, put options can still lose money, because after the release there’s no more uncertainty so demands vanish. This is called IV crush.\nSecond, with the formula, we are able to calculate its sensitivity to important factors by differentiating the formula. They are referred to as the “greeks”:\nsensitivity to stock price, delta $=\\partial P_{\\text{call}} / \\partial s$, stock price second derivative, gamma $=\\partial^2P_{\\text{call}} / \\partial s^2$, time decay, theta $=\\partial P_{\\text{call}} / \\partial t$, sensitivity to volatility, vega $=\\partial P_{\\text{call}} / \\partial \\sigma$, sensitivity to interest rate, rho $=\\partial P_{\\text{call}} / \\partial r$. A worth discussing greek is the delta, namely how much the option price will change when the underlying stock price changes by $1$ dollar. The formula is simply delta $= N(d_1)$, and for put options by equation (2) the delta is $N(d_1) - 1$. Since $N(x)$ is increasing, and strike $X$ appears as denominator in $d_1$, we see that deltas have a negative relationship with strikes. In other words, ITM options have large deltas, while OTM options have small deltas. That’s part of the reason why in-the-money options are expensive while out-of-the-money ones are cheaper. If deltas were the same for all strikes, then it would only be optimal to trade far out-of-the-money options, which is unreasonable.\nSuppose you bought an OTM call option. Its price will have slow response to the underlying stock price movement. However, as the price continues to increase so that it becomes an ITM option, your net profit/loss will become more volatile. For deep in-the-money calls, the delta is close to 1, so that 1 USD up or -1 USD down magnifies to +100 USD gain or -100 USD loss.\nDerivation of delta Since the derivative of $\\log(ax)$ is $(1/ax)\\cdot a = 1/x$, we have $$ \\frac{\\partial d_1}{\\partial s_0} = \\frac{\\partial d_2}{\\partial s_0} = \\frac{1}{s_0\\sigma\\sqrt{T}}. $$ With also $$ d_1^2 - d_2^2 = (A+B)^2 - (A-B)^2 = 4AB = 2\\log\\left(\\frac{e^{rT}s_0}{X}\\right), $$ the delta is $$ \\begin{align*} \\Delta \u0026= \\frac{\\partial}{\\partial s_0}\\left( s_0 N(d_1) - e^{-rT} X\\cdot N(d_2) \\right) \\newline \u0026= N(d_1) + s_0 n(d_1) \\frac{\\partial d_1}{\\partial s_0} - e^{-rT} X n(d_2) \\frac{\\partial d_2}{\\partial s_0} \\newline \u0026= N(d_1) + \\frac{n(d_1)}{\\sigma\\sqrt{T}} \\left( 1 - e^{(d_1^2-d_2^2)/2}\\frac{X}{e^{rT}s_0} \\right) \\newline \u0026= N(d_1) + \\frac{n(d_1)}{\\sigma\\sqrt{T}} \\left( 1 - \\frac{e^{rT}s_0}{X}\\cdot\\frac{X}{e^{rT}s_0} \\right) \\newline \u0026= N(d_1). \\end{align*} $$ Another important greek is theta. The formula is $$ \\begin{align*} \\text{call theta} \u0026= -\\frac{s\\cdot\\sigma\\cdot N'(d_1)}{2\\sqrt{T}} - re^{-rT}X\\cdot N(d_2)\\newline \\text{put theta} \u0026= -\\frac{s\\cdot\\sigma\\cdot N'(d_1)}{2\\sqrt{T}} + re^{-rT}X\\cdot N(-d_2) \\end{align*} $$\nAs we can see from the plot below, holding expiration, interest rate and volatility constant, time decay is fastest for at-the-money options. This justifies short straddle, butterfly and condor strategies which essentially short thetas.\nIn general, if you’re an intraday trader, you would want to buy deep in-the-money options, so that you can realize your profit sooner and don’t have to wait long to fight against theta. If you do long-term trades, then you probably want to buy out-of-the-money ones, to not let short term gains and losses distract you.\nFinally, here is the Python implementation for Black-Scholes formula.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 import math import scipy.stats as stats def N(x): return stats.norm.cdf(x) def delta(s, X, T, r, sigma, typ='call'): d1 = (np.log(s/X) + (r + sigma**2/2)*T) / (sigma * math.sqrt(T)) return N(d1) if typ == 'call' else N(d1) - 1 def theta(s, X, T, r, sigma, typ='call'): d1 = (np.log(s/X) + (r + sigma**2/2)*T) / (sigma * math.sqrt(T)) d2 = d1 - sigma * math.sqrt(T) if typ == 'call': theta = -s * stats.norm.pdf(d1, 0, 1) * sigma / (2 * np.sqrt(T)) - r * X * np.exp(-r * T) * N(d2) elif typ == 'put': theta = -s * stats.norm.pdf(d1, 0, 1) * sigma / (2 * np.sqrt(T)) + r * X * np.exp(-r * T) * N(-d2) return theta def black_scholes(s, X, T, r, sigma, typ='call'): d1 = (np.log(s/X) + (r + sigma**2/2)*T) / (sigma * math.sqrt(T)) d2 = d1 - sigma * math.sqrt(T) price = s * N(d1) - X * math.exp(-r*T) * N(d2) if typ == 'call': return price if typ == 'put': price = price - s + X * math.exp(-r*T) # put-call parity relationship return price Now let’s see how the Black-Scholes formula is derived. Since the Black-Scholes PDE will be converted to the heat equation in physics, as a first step we look at how the heat equation is derived.\nThe heat equation in physics Let’s derive the heat equation in one dimension. The heat equation describes how temperature will evolve as a function of time and space. Let $u(x, t)$ be temperature at location $x$ and time $t$. Note $x$ is a fixed position in space, not cumulative distance. We can choose either left (⬅) or right (➡) at $x$​ as a direction. Here we choose right.\nThe heat equation model consists of following components.\nEnergy at $x$ is proportional to temperature at $x$: $$ E \\sim u\\cdot dx \\Longrightarrow\\quad\\frac{dE}{dt} \\sim \\frac{du}{dt}dx $$\nFlux is proportional to temperature change at opposite direction: $$ q \\sim -k\\frac{du}{dx} $$ This means heat flows from high temperature regions to low temperature regions. Note that we cannot determine the flux only with absolute value of temperature $|u|$. But if $u$ is increasing at $x$, it means the right of $x$ is hotter, the left is cooler, so heat will flow from right to left, and vice versa. The larger the difference, the larger the flux will be. if $u$ plateaus at $x$, there will be no flow of heat. We then get $$ \\frac{dq}{dx} \\sim -k\\frac{d^2u}{dx^2} $$\nThe heat equation model says, at position $x$, change in energy over time is due to flux of heat around it: $$ \\frac{dE}{dt} \\sim dq $$ thus we get the heat equation (PDE) $$ \\boxed{\\frac{du}{dt} = \\alpha\\frac{d^2u}{dx^2}} $$\nWhile $u\\equiv0$ is a solution, it might not satisfy the initial condition. To solve the equation, we decompose the function as $u(x, t) = \\lambda(t)w(x)$, so that $$ \\frac{d\\lambda}{dt}w(x) = \\alpha\\frac{d^2w}{dx^2}\\lambda(t) $$ Divide both sides by $\\lambda(t)w(x)$, we get $$ \\frac{1}{\\lambda}\\frac{d\\lambda}{dt} = \\alpha\\frac{d^2w}{dx^2}\\frac{1}{w} \\equiv c $$ it is equal to some constant $c$ because the left side only involves variable $t$ and the right side only involves $x$.\nNow, $\\dot{\\lambda}=c\\lambda$, so $\\lambda(t)$ will be an exponential function. $\\ddot{w}=cw$, i.e. the second derivative of $w$ is itself, so $w$ will be some sinusoid wave. The solution to $u(x, t)$ is an exponential decay of sine waves, i.e. it is composed of something like $$ u(x, t) = e^{-c_1t}\\cdot\\sin(c_2x). $$ Note that the heat equation $\\dot{u}=\\nabla^2u$ is linear: if $u_1$ and $u_2$ are solutions to the heat equation, then so is $u=u_1+u_2$. In order for the solution to satisfy initial temperature shape $u(x, 0) = f(x)$ for some $f(x)$ on $[0, L]$, we represent $u(x,t)$ with an orthonormal basis $\\{e_n\\}_{n=1}^{\\infty}$ in the function space $L^2$, specifically $$ e_n(x) = \\sqrt{\\frac{2}{L}}\\sin\\left(\\frac{n\\pi x}{L}\\right). $$ The general solution is $$ u(x, t) = \\sum_{n=1}^\\infty \\langle f, e_n\\rangle e_n \\cdot e^{-\\frac{n^2\\pi^2\\alpha t}{L^2}} $$ where $$ \\langle f, e_n\\rangle = \\int_0^Lf(x)e_n(x)dx. $$ Finally, we can easily extend the heat equation to 3d, $\\dot{u}=\\alpha\\nabla^2 u$.\nThe Black-Scholes equation Let $u(x, t)$ denote the value of a call option at stock price $x$ and time $t$​. With the following assumptions:\nthe stock price $x$ is a stochastic process following the geometric brownian motion $$ dx = x\\bigg(\\mu dt + \\sigma dW\\bigg) $$ the risk-free rate $r$ is constant, the volatility $\\sigma$ of the stock is constant, the option price $u(x, t)$ satisfies the following stochastic partial differential equation (SPDE): $$ \\boxed{\\frac{\\partial u}{\\partial t}=ru-rx\\cdot u_x-\\frac{1}{2}\\sigma^2x^2\\cdot u_{xx}} $$\nDerivation of the Black-Scholes equation Ito’s lemma If $x$ is a stochastic process such that $dx = \\mu dt +\\sigma dW$, and $f$ is a twice-differentiable scalar function, then the differential of $f(x, t)$ is given by $$ df = \\bigg(f_t+\\mu f_x+\\frac{\\sigma^2}{2}f_{xx}\\bigg)dt + \\sigma f_xdW $$ It can be derived from the taylor expansion of $f(x, t)$ with the fact that $dt^2$, $dtdW$ and higher order terms all goes to $0$ and $dW^2=dt$.\nUsing the Ito’s lemma for our stock price $x$, we get $$ du = \\left(u_t + \\mu x\\cdot u_x + \\frac{\\sigma^2}{2}x\\cdot u_{xx}\\right)dt + \\sigma x\\cdot u_xdW $$ Now construct a portfolio that shorts on the call $u$ and longs for $u_x$ shares of stocks, i.e. a covered call: $$ H = -u + u_x\\cdot x $$ Over $dt$, the total profit or loss is $$ \\begin{aligned} dH \u0026= -du + u_xdx\\ \u0026= -du + u_x\\cdot x\\left(\\mu dt + \\sigma dW\\right)\\ \u0026= \\left(-u_t - \\frac{\\sigma^2}{2}x^2\\cdot u_{xx}\\right)dt \\end{aligned} $$ The $dW$ term cancels out, leaving with no uncertainty, so the return must equal risk free rate (arbitrage free assumption): $$ \\begin{aligned} dH \u0026= H\\cdot rdt\\ \u0026= (-ru + rx\\cdot u_x),dt \\end{aligned} $$ Rearrange we get the Black-Scholes equation $$ u_t = ru - rx\\cdot u_x - \\frac{\\sigma^2}{2}x^2\\cdot u_{xx} $$\nSolving the Black-Scholes equation A series of change of variables can transform the Black-Scholes equation into the heat equation:\nset $y = \\log(x)$ to convert the (multiplicative) geometric brownian motion into additive one. set $\\tau = T - t$ to align with the diffusion direction in heat equation. add an exponential term to $u(x, t)$​ to account for the exponential decay in the solution of heat equation. Set $w(y, \\tau) = e^{\\alpha\\tau}u(x, t)$, where $\\alpha=r - \\frac{1}{2}\\sigma^2$. Under these, the equation becomes $$ w_t = \\frac{1}{2}\\sigma^2w_{yy} $$ which is the heat equation that we have discussed above. Separation of variables and Fourier transforms can be used to solve the equation analytically. Once the solution is found, $u(x, t)$ can be obtained by reversing the change of variables: $$ u(x, t) = e^{-\\alpha\\tau}w(y, \\tau) $$\nIs the Black-Scholes model realistic? There has been some criticism of the Black-Scholes model ( Citation: Haug \u0026 Taleb, 2011 Haug, E. \u0026 Taleb, N. (2011). Option traders use (very) sophisticated heuristics, never the black–scholes–merton formula. Journal of Economic Behavior \u0026 Organization, 77(2). 97–106. ) . Empirically, numbers given by the Black-Scholes formula match closely to actual option prices, yet are always somewhat higher than the actual ones. This is because real markets differ from core model assumptions:\nContinuity assumption. In the Black-Scholes model, stock prices are assumed to follow geometric brownian motion. In reality, it’s never the case. First, stock prices have discrete jumps in part due to limited trading hours. In the US market, stocks are traded from 9:30 AM to 4:00 PM US eastern time. Accumulated news and sentiments can result in next day’s open price to differ sharply from yesterday’s close price. Even if there are pre-market and post-market trades, options however do not enjoy extra trading hours and are only traded in normal trading hours.\nstock prices have jumps\nBut most importantly, stock prices are not random walks that are governed by few parameters. Sometimes the price will drift to some interval and then get stuck there for a long time, other times it will have strong momentum to go for a single direction. Different stocks exhibit different patterns, and all the patterns are different from purely random walks. Behind the scenes, prices are formed by human demand and supply, by strategic interactions among market players, by their expectations, intentions, reactions and emotions. Predicting or characterizing stock price is a very challenging problem. Because real stock prices don’t have the nice properties of geometric brownian motion, and they are harder to predict, it is harder to make a return on options, so premiums will be lower than what the model predicts.\nLiquidity assumption. The option pricing model doesn’t take liquidity into account. In other word, it assumes that the market is liquid. This again is not realistic. Since options are derivative products with high risks, trading volume is far less than their underlying stocks and ETFs. Trades can occur very sparsely during a trading day, especially for deep OTM/ITM ones and options with long expirations. In such cases, the bid-ask spread can become a non-negligible factor to your profit calculation.\nNonetheless, the Black-Scholes model provides a very useful framework for thinking about options, for example implied volatility and the greeks.\nClosing Remarks In this post we discussed several common option trading strategies. We showed how puts and calls can be combined to encounter various market situations. We also discussed the Black-Scholes model in detail, and showed how its properties can help us choose options. But no single strategy can give you persistent profits. For example, while selling puts/calls and capturing time decays might seem a good idea to generate stable cash flows, a large unexpected move can wipe out your gains accumulated over a long time. The most important challenge for trading remains about predicting the timing, direction and scale of future stock price movements for as accurate as possible.\nReferences ◎ Black, F. \u0026 Scholes, M. (1973). The pricing of options and corporate liabilities. Journal of political economy, 81(3). 637–654. ◎ Haug, E. \u0026 Taleb, N. (2011). Option traders use (very) sophisticated heuristics, never the black–scholes–merton formula. Journal of Economic Behavior \u0026 Organization, 77(2). 97–106. ","wordCount":"5842","inLanguage":"en","image":"https://lifei.ai/imgs/opt/cover.jpg","datePublished":"2024-11-26T00:00:00Z","dateModified":"2024-11-26T00:00:00Z","author":{"@type":"Person","name":"Fei Li"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://lifei.ai/posts/2024-11-26-options/"},"publisher":{"@type":"Organization","name":"lifei.ai | AI blogs","logo":{"@type":"ImageObject","url":"https://lifei.ai/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://lifei.ai/ accesskey=h title="lifei.ai (Alt + H)"><img src=https://lifei.ai/f.png alt aria-label=logo height=40>lifei.ai</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://lifei.ai/archives/ title=Archives><span>Archives</span></a></li><li><a href=https://lifei.ai/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://lifei.ai/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://lifei.ai/>Home</a>&nbsp;»&nbsp;<a href=https://lifei.ai/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">Options Trading and the Black-Scholes Model</h1><div class=post-meta><span title='2024-11-26 00:00:00 +0000 UTC'>November 26, 2024</span>&nbsp;·&nbsp;28 min&nbsp;·&nbsp;Fei Li</div></header><figure class=entry-cover><img loading=eager src=https://lifei.ai/imgs/opt/cover.jpg alt="post cover"><p>source: pinterest</p></figure><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#basics>Basics</a></li><li><a href=#trading-strategies>Trading Strategies</a><ul><li><a href=#protective-put-pp>protective put (pp)</a></li><li><a href=#covered-call-cc>covered call (cc)</a></li><li><a href=#straddle>straddle</a></li><li><a href=#strangle>strangle</a></li><li><a href=#vertical-spread>vertical spread</a></li><li><a href=#calendar-spread>calendar spread</a></li><li><a href=#butterfly>butterfly</a></li><li><a href=#iron-butterfly>iron butterfly</a></li><li><a href=#condor>condor</a></li><li><a href=#iron-condor>iron condor</a></li></ul></li><li><a href=#put-call-parity-relationship>Put-call parity relationship</a></li><li><a href=#the-binomial-options-pricing-model>The binomial options pricing model</a></li><li><a href=#the-black-scholes-model>The Black-Scholes model</a><ul><li><a href=#the-black-scholes-formula>The Black-Scholes formula</a></li><li><a href=#the-heat-equation-in-physics>The heat equation in physics</a></li><li><a href=#the-black-scholes-equation>The Black-Scholes equation</a></li><li><a href=#derivation-of-the-black-scholes-equation>Derivation of the Black-Scholes equation</a></li><li><a href=#solving-the-black-scholes-equation>Solving the Black-Scholes equation</a></li></ul></li><li><a href=#is-the-black-scholes-model-realistic>Is the Black-Scholes model realistic?</a></li><li><a href=#closing-remarks>Closing Remarks</a></li><li><a href=#references>References</a></li></ul></nav></div></details></div><div class=post-content><h2 id=basics>Basics<a hidden class=anchor aria-hidden=true href=#basics>#</a></h2><p>An option is a financial contract that gives you the right (but not obligation) to buy or sell usually 100 shares of the underlying asset at a strike price $X$ at or before some specific date, usually Fridays. The price of an option is quoted on a <em>per share</em> basis, for example 5.5 USD. To buy the option, you have to pay 5.5 x 100 = 550 USD. If the option later rises to 6.0 USD, you can sell the option and get a profit of (6-5.5) x 100 = 50 USD. For convenience, in this post we will omit the multiplier and hold our discussions on a per share basis.</p><p>The most traded stock and ETF options in the US market are those for SPY, QQQ, Tesla, Nvidia, among others. There can be other types of options, for example options on index and futures. For convenience, we will use the word &ldquo;stock&rdquo; to refer to the underlying asset. We will use the following notations unless otherwise stated.</p><ul><li>$X$ for strike price; $T$ for expiration date;</li><li>$s$ or $s_T$ for stock price; $P$ for option price.</li></ul><p>There are two types of options: call options and put options.</p><p>A <strong>call option</strong> is a contract that gives you the right to purchase 100 shares of some stock at or before expiration date $T$. At expiration,</p><ul><li>profit to long position is $v(s_T)=\max(0,s_T-X)-P$. Maximum profit is $+\infty$.</li><li>profit to short position is $-v(s_T)=\min(0,X-s_T)+P$. Maximum loss is $-\infty$.</li></ul><figure class=align-center><img loading=lazy src=/imgs/opt/call.png#center width=500></figure><p>A <strong>put option</strong> is a contract that gives you the right to sell 100 shares of some stock at or before expiration date $T$. At expiration,</p><ul><li>profit to long position is $v(s_T) = \max(0,X-s_T)-P$. Maximum profit is $X-P$ when the stock price drops to zero.</li><li>profit to short position is $-v(s_T) = \min(0,s_T-X) + P$. Maximum loss is $P-X$.</li></ul><figure class=align-center><img loading=lazy src=/imgs/opt/put.png#center width=500></figure><p>An option is <strong>in-the-money (ITM)</strong> if the current stock price is above (for call) or below (for put) the strike price, so that exercising the option now can generate a positive payoff. It is <strong>out-of-the-money (OTM)</strong> if the reverse situation is true, so that it is temporarily not profitable to exercise the option. It is <strong>at-the-money (ATM)</strong> if the stock price is equal to the strike price. In practice, this moneyness concept is very important to keep in mind for selecting the right options and constructing trading strategies.</p><p>The price of a option consists of two parts: <strong>time value</strong> and <strong>intrinsic value</strong>.</p><ul><li>the <strong>intrinsic value</strong> is the difference between current stock price and strike price if it is in-the-money, and 0 otherwise.</li><li>the <strong>time value</strong> is option price minus the intrinsic value, namely the remaining part in the option price.</li></ul><p>Even though you cannot profit from an OTM call contract by exercising the option, the stock price has the possibility to rise up beyond the strike price in the future and make the contract profitable. For this reason, all types of options including OTM ones are bought and sold with positive premiums.</p><p>When you buy an option and exercise it, you can only get its intrinsic value, but not its time value. Further, you have to prepare adequate cash or stocks needed for settlement, and can incur transaction fees. For this reason, you typically close your position by selling the option, instead of exercising it. On the other hand, for option sellers (or writers), because such possibility exists, you are required to maintain a good amount of margin. If the price of the option you sold continues to rise, you margin may become inadequate, and you may receive a margin call.</p><p>Option trading is a zero-sum game. The money you earned from trading options must come from somebody else&rsquo;s pocket. At the same time, option is a financial derivative that can be used to hedge risks. Together with other derivatives like futures and swaps, they are part of modern risk management toolbox. By trading stocks and options, traders provide liquidity to the financial market and help discover fair asset prices. Now let&rsquo;s discuss some most commonly used option trading strategies in practice.</p><h2 id=trading-strategies>Trading Strategies<a hidden class=anchor aria-hidden=true href=#trading-strategies>#</a></h2><h3 id=protective-put-pp>protective put (pp)<a hidden class=anchor aria-hidden=true href=#protective-put-pp>#</a></h3><p>Suppose you bought some company&rsquo;s stocks at price $s_0$, in hope that your can sell the stock at a higher price $s_T$ in the future. To protect yourself against unexpected price drops, you can spend $-P$ to buy put options on that stock as a kind of insurance. Suppose the strike price $X$ is equal to $s_0$.</p><p>At the end of period, if the price goes up, you obtain gains with initial spending of $-P$. If price goes down, let&rsquo;s say to 0, you can exercise the put and close your stock position at initial price $s_0$, protecting you from losing all the investments ($s_0$ times quantity).</p><p>By definition, your pp profit at $T$ is equal to stock profit $(s_T-s_0)$ ➕ put option profit:
$$
(s_T - s_0) + \bigg(\max(0, X-s_T)-P_{\text{put}}\bigg) = \max(X,s_T)-P_{\text{put}}-s_0.
$$</p><p>Since $\max(X, s_T) - X = \max(0, s_T-X)$, in the case $X\equiv s_0$, protective put is similar to <em><strong>buying a call option</strong></em> with the same strike price. The difference is that the down payment is the price of a put $P_{\text{put}}$, instead of a call $P_{\text{call}}$.</p><h3 id=covered-call-cc>covered call (cc)<a hidden class=anchor aria-hidden=true href=#covered-call-cc>#</a></h3><p>A covered call is a situation where you sell call contracts with underlying stocks at your deposit. Typically, you are a long-term shareholder of a company, say Nvidia. A covered call lets you profit from short-term price drops and weak movements.</p><ol><li>If the price unexpectedly goes up, you give away your stock at strike price $X$ instead of the more lucrative price $s_T$, capping your profit at $(X-s_0) + P$.</li><li>If the price goes down, you will be safe with the premium from selling the call. Although your stock value will decrease on paper, you are optimistic about the company in the long-term and thus will not sell your stocks.</li></ol><p>Mathematically, the profit at end period $T$ is equal to the sum of profit from long position on stocks and short position on calls</p><p>$$
(s_T -s_0) + \bigg(\min(0,X-s_T)+P_{\text{call}}\bigg) = \min(X, s_T) + P_{\text{call}} - s_0
$$</p><p>Since $\min(X, s_T) - X = \min(0, s_T-X)$, in the case $X\equiv s_0$, covered call is similar to <em><strong>selling a put option</strong></em> with the same strike price. The difference is that the premium comes from selling a call $P_{\text{call}}$, instead of a put $P_{\text{put}}$.</p><figure class=align-center><img loading=lazy src=/imgs/opt/cc.png#center width=500></figure><blockquote><p>In strategies like covered call, you can further use <strong>rolling</strong> to adjust your positions. Rolling refers to closing your short position on the derivative (i.e. buy back) and then open a different one. For covered call strategy, there are three cases:</p><ul><li><strong>rolling-up:</strong> when stock price goes up, unfavorably for your short position on the call, if you still assume limited possibility for a large hike, you can close your current position (with possible losses) and sell a call with a higher strike price $X$, hoping that price will not go that high.</li><li><strong>rolling-down:</strong> when stock price goes down, maybe the contract you sold already lost most of its value, so you can close your position and substitute it with a lower-strike call, to protect your stocks and increase your premium income.</li><li><strong>rolling-forward:</strong> when the contract you sold is soon to expire, you can substitute it with a distant one.</li></ul></blockquote><blockquote><p><strong>Quiz.</strong> Why it may not be a good idea to sell a put option, regardless of whether you have long position or short position of the underlying stock? Draw the profit graph in each case.</p></blockquote><h3 id=straddle>straddle<a hidden class=anchor aria-hidden=true href=#straddle>#</a></h3><p>A straddle is one put plus one call with the same strike $X$ and expiration $T$, with V-shaped profit curve. It will profit when price have large moves in the future, no matter its direction. It is a bet on volatility.</p><p>Be cautious when using this strategy before major events like earnings release. When large volatility is a consensus, it will be priced into the options. With such expensive prices, the actual volatility has to go even further beyond current expectation for you to profit. Otherwise, you may never come out of the V-shape valley.</p><p>That&rsquo;s long straddle. Conversely, you can also short the straddle, betting that the stock price will not have significant movements. The profit curve is a flipped V.</p><figure class=align-center><img loading=lazy src=/imgs/opt/straddle.png#center width=500></figure><h3 id=strangle>strangle<a hidden class=anchor aria-hidden=true href=#strangle>#</a></h3><p>strangle is similar to straddle, but with buying a put and a call with different strike prices $X_1$ and $X_2$. Typically, they are all out-of-money options, namely $X_1 &lt; s &lt; X_2$, so they are cheaper, but it requires greater volatility to profit.</p><figure class=align-center><img loading=lazy src=/imgs/opt/strangle.png#center width=500></figure><h3 id=vertical-spread>vertical spread<a hidden class=anchor aria-hidden=true href=#vertical-spread>#</a></h3><p>A vertical spread is simultaneous purchase and sale of the same kind of option (either two calls or two puts) with same expiration $T$ but different strike prices $X_1$ and $X_2$. It can reduce the premium you have to pay while also cap profits.</p><p>When you expect the stock market to rise slowly in the future, you can establish a vertical spread using either calls or puts. The two approaches&rsquo; profit curves share the same shape.</p><ul><li><strong>Bull call spread / call debit spread.</strong> you can buy a call with lower $X_1$ (expensive) and sell a call with higher $X_2$ (cheaper).</li><li><strong>Bull put spread / put credit spread.</strong> you can buy a put with lower $X_1$ (cheaper) and sell a put with higher $X_2$ (expensive).</li></ul><p><figure class=align-center><img loading=lazy src=/imgs/opt/bull-spread-illu.png#center width=500></figure><figure class=align-center><img loading=lazy src=/imgs/opt/bull-spread.png#center width=500></figure></p><blockquote><p>a <strong>collar</strong> is buy stocks, buy put, and sell call with a high strike price. Since protective put (pp) is similar to buying a call, we see that collar is similar to a bull call spread.</p></blockquote><p>Conversely, when you expect the stock market to fall slowly in the future, you can establish a bear spread by reversing the strategies above.</p><ul><li><strong>Bear call spread / call credit spread.</strong> you can sell a call with lower $X_1$ (expensive) and buy a call with higher $X_2$ (cheaper).</li><li><strong>Bear put spread / put debit spread.</strong> you can sell a put with lower $X_1$ (cheaper) and buy a put with higher $X_2$ (expensive).</li></ul><p><figure class=align-center><img loading=lazy src=/imgs/opt/bear-spread-illu.png#center width=500></figure><figure class=align-center><img loading=lazy src=/imgs/opt/bear-spread.png#center width=500></figure></p><h3 id=calendar-spread>calendar spread<a hidden class=anchor aria-hidden=true href=#calendar-spread>#</a></h3><p>The time value of a short period option decays fast, especially when price often moves in the unfavorable direction. A calendar spread involves buying a distant option ($T_2$) and selling a short period one ($T_1$) with the same strike price, to capture the time value of the short period option. The option can be either call or put. Both have a similar profit curve.</p><p>The plot below shows our profit standing at time $T_1$, when the time value for the short-period option expires but longer-period option&rsquo;s time value still exists.</p><figure class=align-center><img loading=lazy src=/imgs/opt/calendar-spread.png#center width=500></figure><h3 id=butterfly>butterfly<a hidden class=anchor aria-hidden=true href=#butterfly>#</a></h3><p>The butterfly strategy, along with the condor strategy below, are strategies that profit from minimal movement in the underlying stock price. It can be implemented using either 4 calls or 4 puts, and typically involves three options with three strike prices $X-a$, $X=s_0$, and $X+a$. Using call option as an example, it consists of:</p><ul><li>buying 1 in-the-money call with strike $X-a$</li><li>selling 2 at-the-money call with strike $X = s_0$</li><li>buying 1 out-of-money call with strike $X+a$.</li></ul><p>You sell 2 at-the-money calls betting price will stay flat. You buy ITM and OTM calls to cap your loss in case the stock price has unexpected large fluctuations.</p><figure class=align-center><img loading=lazy src=/imgs/opt/butterfly.png#center width=500></figure><h3 id=iron-butterfly>iron butterfly<a hidden class=anchor aria-hidden=true href=#iron-butterfly>#</a></h3><p>In the butterfly strategy you trade 4 options of the same type. Iron butterfly uses a mix of 2 puts and 2 calls. You typically <em><strong>short</strong></em> an iron butterfly to capture ATM options&rsquo; time values when price is stable. A short iron butterfly can consist of</p><ul><li>buying 1 out-of-money put with strike $X - a$</li><li>selling 1 at-the-money <strong>put</strong> with strike $X$</li><li>selling 1 at-the-money <strong>call</strong> with strike $X$</li><li>buying 1 out-the-money call with strike $X + a$</li></ul><p>The profit curve shape for short iron butterfly is the same as butterfly above.</p><figure class=align-center><img loading=lazy src=/imgs/opt/short-iron-butterfly.png#center width=500></figure><h3 id=condor>condor<a hidden class=anchor aria-hidden=true href=#condor>#</a></h3><p>Condor is similar to butterfly. While in butterfly you sell 2 options with identical strike price, in condor you sell 2 options with different strike prices. This allows you to capture a wider range of potential values, but has a higher premium and therefore a lower maximum profit.</p><p>Again using call option as an example, with $X_1 &lt; X_2$, it consists of</p><ul><li>buying call1 with strike $X_1-a$</li><li>selling call2 with strike $X_1$</li><li>selling call3 with strike $X_2$</li><li>buying call4 with strike $X_2+a$.</li></ul><figure class=align-center><img loading=lazy src=/imgs/opt/condor.png#center width=500></figure><h3 id=iron-condor>iron condor<a hidden class=anchor aria-hidden=true href=#iron-condor>#</a></h3><p>Similar to short iron butterfly, the short iron condor strategy captures option time value lost from stable price movement over time from selling one put and one call near current price, then cover the position with OTM put and call. With $X_1 &lt; X_2$, it consists of</p><ul><li>buying 1 out-of-money put with strike $X_1 - a$</li><li>selling 1 at-the-money <strong>put</strong> with strike $X_1$</li><li>selling 1 at-the-money <strong>call</strong> with strike $X_2$</li><li>buying 1 out-the-money call with strike $X_2 + a$</li></ul><figure class=align-center><img loading=lazy src=/imgs/opt/short-iron-condor.png#center width=500></figure><blockquote><p><strong>Quiz.</strong> Draw each strategy&rsquo;s profit curve according to their definitions, as shown above, using Python or any programming language that you&rsquo;re comfortable with.</p></blockquote><h2 id=put-call-parity-relationship>Put-call parity relationship<a hidden class=anchor aria-hidden=true href=#put-call-parity-relationship>#</a></h2><p>Put options and call options are clearly related. For example, we saw earlier that the profit curve for protective put (pp) is similar to that of a call option, and the profit curve for covered call (cc) is similar to shorting a put option. Let&rsquo;s now add risk-free rate into the equation and derive their relationship.</p><p>Consider portfolio A that consists of a call with strike $X$ and risk-free zero-­coupon bond with face value $X$. At the end of period $T$,</p><ol><li>if $s_T \leq X$, the portfolio&rsquo;s payoff is $0 + X = X$</li><li>if $s_T > X$, the portfolio&rsquo;s payoff is $(s_T - X) + X = s_T$</li></ol><p>Now consider portfolio B of a protective put (pp), which consists of stock $s$ and put option with strike $X$. The payoff at $T$ is:</p><ol><li>if $s_T \leq X$, the portfolio&rsquo;s payoff is $(X - s_T) + s_T = X$</li><li>if $s_T > X$, the portfolio&rsquo;s payoff is $0 + s_T = s_T$</li></ol><p>Therefore, the two portfolio&rsquo;s payoffs are the same, so their costs (or prices) must be identical as well. Let us denote the call option price as $P_{\text{call}}$, put option price as $P_{\text{put}}$ , and noting that the risk-free bond is worth $X / (1 + r)^T$ today, we have</p><p>$$
P_{\text{call}} + \frac{X}{(1+r)^T} = P_{\text{put}} + s_0
$$</p><p>This is the put-call parity relationship. More generally,</p><p>$$
P_{\text{put}} = P_{\text{call}} - s_0 + \mathrm{PV}(X) + \mathrm{PV}(\text{dividends})
$$</p><p>The put-call parity relationship can be used to derive corresponding put option price once we have calculated call option price for the same strike price, and vice versa.</p><p>Option prices depend on several factors, including the stock price, strike price, volatility, expiration date, risk-free rate, and dividends. Among them, the most crucial one is the <strong>volatility</strong> of the stock. The more volatile a stock is, the more likely it is to hit some strike price somewhere in the future and make such options profitable. For this reason, for stocks that have high variances, their options are typically more expensive. Once volatility crushed, e.g. after earnings, near-expiration OTM option prices typically will also collapse.</p><p>Another important factor is <strong>time</strong>. Longer periods allow more room for price movement, so distant date options are more expensive than nearer ones. Timing is extremely important for option trading. You might successfully predict that some stock will go up in the future. But when? At what point should you open your position? Option prices can vary greatly from day to day. Being able to predict the general trend does not guarantee profits.</p><p>Now we discuss two most well-known option pricing models, the binomial options pricing model and its continuous variant, the Black-Scholes model
<span class=hugo-cite-intext itemprop=citation>(<span class=hugo-cite-group>
<a href=#black-scholes><span class=visually-hidden>Citation: </span><span itemprop=author itemscope itemtype=https://schema.org/Person><meta itemprop=givenName content="Fischer"><span itemprop=familyName>Black</span></span> & <span itemprop=author itemscope itemtype=https://schema.org/Person><meta itemprop=givenName content="Myron"><span itemprop=familyName>Scholes</span></span>, <span itemprop=datePublished>1973</span></a><span class=hugo-cite-citation>
<span itemscope itemtype=https://schema.org/Article data-type=article><span itemprop=author itemscope itemtype=https://schema.org/Person><span itemprop=familyName>Black</span>, <meta itemprop=givenName content="Fischer">F.</span> & <span itemprop=author itemscope itemtype=https://schema.org/Person><span itemprop=familyName>Scholes</span>, <meta itemprop=givenName content="Myron">M.</span>
 
(<span itemprop=datePublished>1973</span>).
 <span itemprop=name>The pricing of options and corporate liabilities</span>.<i>
<span itemprop=about>Journal of political economy</span>, 81(3)</i>. <span itemprop=pagination>637–654</span>.</span>
</span></span>)</span>
. The idea behind the two and many other pricing models is <em>replication</em>, namely constructing a portfolio with identical payoff, and pricing the option as the portfolio&rsquo;s cost.</p><h2 id=the-binomial-options-pricing-model>The binomial options pricing model<a hidden class=anchor aria-hidden=true href=#the-binomial-options-pricing-model>#</a></h2><p>Let&rsquo;s start with an example. Suppose the stock price now is $s_0=100$, and suppose after one period there&rsquo;re two scenarios with equal probability: the stock price either goes up by $u=1.2$ to $120$, or goes down by $d=0.9$ to $90$.</p><pre tabindex=0><code>  100         
  / \
90  120
</code></pre><p>A call option with price $P$ and strike $X=110$ will have the following payoff:</p><pre tabindex=0><code>  P        
 / \      
0  10      
</code></pre><p>To replicate the payoff, suppose interest rate $r$ is $0.1$. We use leverage and put in $18.18$ and borrow $90 / (1 + r) = 81.82$ for a total of $100$ dollars and buy one share of stock. After one period we sell the stock and pay back the loan. The return is either $0$ or $30$.</p><pre tabindex=0><code> 18.18
 / \
0  30
</code></pre><p>The payoff is 3 times the call option&rsquo;s payoff, so the portfolio&rsquo;s cost must also equal to 3 times the option&rsquo;s price:</p><p>$3P = 18.18 \Longrightarrow P = 6.06$.</p><p>This is how the binomial model prices options in essence. Now let&rsquo;s generalize. We divide $T=1$ into $n$ periods, where stock price can go up by $u$ with probability $p$ or go down by $d$ with probability $(1-p)$ in each period. Each possible final price $s_T$ corresponds to a sequence of experiments:</p><p>$$
\text{trial} = (u, u, d, \ldots, u)\quad\Rightarrow\quad s_T = u^kd^{n-k}\cdot s_0
$$</p><p>The value of a call option in period $n$ depends on stock price $s_T$. Different trials lead to different $s_T$. The probability of each trial can be described by binomial distribution that assigns probability $\mathbb{P}(k)$ to $k$ successes for each $k=0,\ldots,n$ :</p><p>$$
\mathbb{P}(k) = \binom{n}{k}p^k(1-p)^{n-k}.
$$</p><p>In the example above, we set some arbitrary values for $u$, $d$ and $p$, but in general they should depend on volatility of the stock price, $\sigma$. One way is to set</p><p>$$
u = e^{\sigma\sqrt{\Delta t}}, \quad d = e^{-\sigma\sqrt{\Delta t}}
$$</p><p>where $\Delta t = T/n$. For $p$, we use the risk-neutral probability trick: since option pricing is independent from risk attitude, we can posit everyone to be risk-neutral, so that no other returns but only risk-free rate $r$ is preferred. This means $\mathbb{E}(s)$ should be $(1+r\Delta t)\cdot s$ :</p><p>$$
p\cdot uS+(1-p)\cdot dS = (1+r\Delta t)S \quad\Rightarrow\quad p = \frac{1+r\Delta t-d}{u-d}
$$
In this risk-neutral world, the value of the call today is its expected value in the next period discounted by risk-free rate. With this, we can start from the final nodes where $P_T = (s_T - X)^+$ and work <strong>backwards</strong> to get values at previous nodes, all the way to the root $P_0$.
$$
P_i = \frac{p\cdot P_{i+1,u}+(1-p)\cdot P_{i+1,d}}{1+r\Delta t}
$$
For $n$ large, $e^{r\Delta t}\approx1+r\Delta t$ so we can substitute the discount term with $e^{r\Delta t}$​.</p><p>Here is a Python implementation.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>math</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>binomial_option_pricing</span><span class=p>(</span><span class=n>s0</span><span class=p>,</span> <span class=n>X</span><span class=p>,</span> <span class=n>r</span><span class=p>,</span> <span class=n>T</span><span class=p>,</span> <span class=n>sigma</span><span class=p>,</span> <span class=n>n</span><span class=p>,</span> <span class=n>typ</span><span class=o>=</span><span class=s1>&#39;call&#39;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>dt</span> <span class=o>=</span> <span class=n>T</span> <span class=o>/</span> <span class=n>n</span>  <span class=c1># time delta</span>
</span></span><span class=line><span class=cl>    <span class=n>u</span> <span class=o>=</span> <span class=n>math</span><span class=o>.</span><span class=n>exp</span><span class=p>(</span><span class=n>sigma</span> <span class=o>*</span> <span class=n>math</span><span class=o>.</span><span class=n>sqrt</span><span class=p>(</span><span class=n>dt</span><span class=p>))</span>   <span class=c1># up factor</span>
</span></span><span class=line><span class=cl>    <span class=n>d</span> <span class=o>=</span> <span class=mi>1</span> <span class=o>/</span> <span class=n>u</span>                             <span class=c1># down factor</span>
</span></span><span class=line><span class=cl>    <span class=n>p</span> <span class=o>=</span> <span class=p>(</span><span class=n>math</span><span class=o>.</span><span class=n>exp</span><span class=p>(</span><span class=n>r</span> <span class=o>*</span> <span class=n>dt</span><span class=p>)</span> <span class=o>-</span> <span class=n>d</span><span class=p>)</span> <span class=o>/</span> <span class=p>(</span><span class=n>u</span> <span class=o>-</span> <span class=n>d</span><span class=p>)</span>  <span class=c1># risk-neutral probability</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># 1.create a tree to store stock prices and option values</span>
</span></span><span class=line><span class=cl>    <span class=n>stock_prices</span> <span class=o>=</span> <span class=p>[[</span><span class=mi>0</span><span class=p>]</span> <span class=o>*</span> <span class=p>(</span><span class=n>i</span> <span class=o>+</span> <span class=mi>1</span><span class=p>)</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>n</span> <span class=o>+</span> <span class=mi>1</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>    <span class=n>option_values</span> <span class=o>=</span> <span class=p>[[</span><span class=mi>0</span><span class=p>]</span> <span class=o>*</span> <span class=p>(</span><span class=n>i</span> <span class=o>+</span> <span class=mi>1</span><span class=p>)</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>n</span> <span class=o>+</span> <span class=mi>1</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># 2.initialize the final node values based on option type</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>k</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>n</span> <span class=o>+</span> <span class=mi>1</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>stock_prices</span><span class=p>[</span><span class=n>n</span><span class=p>][</span><span class=n>k</span><span class=p>]</span> <span class=o>=</span> <span class=n>u</span><span class=o>**</span><span class=n>k</span> <span class=o>*</span> <span class=n>d</span><span class=o>**</span><span class=p>(</span><span class=n>n</span> <span class=o>-</span> <span class=n>k</span><span class=p>)</span> <span class=o>*</span> <span class=n>s0</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>typ</span> <span class=o>==</span> <span class=s1>&#39;call&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>option_values</span><span class=p>[</span><span class=n>n</span><span class=p>][</span><span class=n>k</span><span class=p>]</span> <span class=o>=</span> <span class=nb>max</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=n>stock_prices</span><span class=p>[</span><span class=n>n</span><span class=p>][</span><span class=n>k</span><span class=p>]</span> <span class=o>-</span> <span class=n>X</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>option_values</span><span class=p>[</span><span class=n>n</span><span class=p>][</span><span class=n>k</span><span class=p>]</span> <span class=o>=</span> <span class=nb>max</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=n>X</span> <span class=o>-</span> <span class=n>stock_prices</span><span class=p>[</span><span class=n>n</span><span class=p>][</span><span class=n>k</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># 3.calculate option values for earlier nodes</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>t</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>n</span> <span class=o>-</span> <span class=mi>1</span><span class=p>,</span> <span class=o>-</span><span class=mi>1</span><span class=p>,</span> <span class=o>-</span><span class=mi>1</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>t</span> <span class=o>+</span> <span class=mi>1</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=n>option_values</span><span class=p>[</span><span class=n>t</span><span class=p>][</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=n>math</span><span class=o>.</span><span class=n>exp</span><span class=p>(</span><span class=o>-</span><span class=n>r</span> <span class=o>*</span> <span class=n>dt</span><span class=p>)</span> <span class=o>*</span> <span class=p>(</span><span class=n>p</span> <span class=o>*</span> <span class=n>option_values</span><span class=p>[</span><span class=n>t</span> <span class=o>+</span> <span class=mi>1</span><span class=p>][</span><span class=n>i</span> <span class=o>+</span> <span class=mi>1</span><span class=p>]</span> <span class=o>+</span> <span class=p>(</span><span class=mi>1</span> <span class=o>-</span> <span class=n>p</span><span class=p>)</span> <span class=o>*</span> <span class=n>option_values</span><span class=p>[</span><span class=n>t</span> <span class=o>+</span> <span class=mi>1</span><span class=p>][</span><span class=n>i</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>option_values</span><span class=p>[</span><span class=mi>0</span><span class=p>][</span><span class=mi>0</span><span class=p>]</span>
</span></span></code></pre></td></tr></table></div></div><p>Example usage:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>s0</span> <span class=o>=</span> <span class=mi>100</span><span class=p>;</span> <span class=n>X</span> <span class=o>=</span> <span class=mi>105</span><span class=p>;</span> <span class=n>r</span> <span class=o>=</span> <span class=mf>0.05</span><span class=p>;</span> <span class=n>T</span> <span class=o>=</span> <span class=mf>0.1</span><span class=p>;</span> <span class=n>sigma</span> <span class=o>=</span> <span class=mf>0.2</span><span class=p>;</span> <span class=n>n</span> <span class=o>=</span> <span class=mi>100</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>call_price</span> <span class=o>=</span> <span class=n>binomial_option_pricing</span><span class=p>(</span><span class=n>s0</span><span class=p>,</span> <span class=n>X</span><span class=p>,</span> <span class=n>r</span><span class=p>,</span> <span class=n>T</span><span class=p>,</span> <span class=n>sigma</span><span class=p>,</span> <span class=n>n</span><span class=p>,</span> <span class=n>typ</span><span class=o>=</span><span class=s1>&#39;call&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>put_price</span> <span class=o>=</span> <span class=n>binomial_option_pricing</span><span class=p>(</span><span class=n>s0</span><span class=p>,</span> <span class=n>X</span><span class=p>,</span> <span class=n>r</span><span class=p>,</span> <span class=n>T</span><span class=p>,</span> <span class=n>sigma</span><span class=p>,</span> <span class=n>n</span><span class=p>,</span> <span class=n>typ</span><span class=o>=</span><span class=s1>&#39;put&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;call option price:&#34;</span><span class=p>,</span> <span class=nb>round</span><span class=p>(</span><span class=n>call_price</span><span class=p>,</span> <span class=mi>2</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;put option price:&#34;</span><span class=p>,</span> <span class=nb>round</span><span class=p>(</span><span class=n>put_price</span><span class=p>,</span> <span class=mi>2</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=c1># call option price: 0.93</span>
</span></span><span class=line><span class=cl><span class=c1># put option price: 5.41</span>
</span></span></code></pre></td></tr></table></div></div><p>We observe that in binomial option pricing model, as each step is either up or down, going many steps is like going through a random walk. More precisely, since it is multiplicative:
$$
u\cdot u\cdot u\cdot d\cdot d\cdot u\cdot u\cdot d\cdots
$$
the log of the above sequence is an additive random walk. In the limit as $n\to\infty$, the additive random walk approaches (the continuous) Brownian motion, so that the original multiplicative process approaches <em><strong>geometric</strong></em> brownian motion. This means in particular that the distribution of the stock price at expiration progressively approaches the <em>lognormal</em> distribution.</p><h2 id=the-black-scholes-model>The Black-Scholes model<a hidden class=anchor aria-hidden=true href=#the-black-scholes-model>#</a></h2><p>The Black-Scholes model is the continuous limit of the binomial pricing model as we divide $T$ into smaller and smaller periods. It is described by a stochastic PDE. We first discuss the solution to the PDE, the Black-Scholes <em>formula</em>, then derive the PDE and its solution later in the post.</p><h3 id=the-black-scholes-formula>The Black-Scholes formula<a hidden class=anchor aria-hidden=true href=#the-black-scholes-formula>#</a></h3><p>With
$$
d_{1,2} = \frac{\log(e^{rT}s_0/X)}{\sigma\sqrt{T}} \pm \frac{1}{2}\sigma\sqrt{T}
$$
and $N(x)$ as the CDF of standard normal:
$$
N(x) = \frac{1}{\sqrt{2\pi}}\int_{-\infty}^xe^{-t^2/2}dt,
$$
the Black-Scholes formula for call option is
$$
\begin{equation}
\boxed{P_\text{call} = s_0\cdot N(d_1) - e^{-rT}X\cdot N(d_2)}
\end{equation}
$$</p><p>This is for $t=0$. For $0 &lt; t &lt; T$, substitute $T$ with $T-t$ and $s_0$ with $s_t$. Put option price can be derived using the put-call parity relationship
$$
\begin{equation}
P_\text{put} = P_\text{call} - s_0 + e^{-rT}X.
\end{equation}
$$</p><p>The first important concept is <strong>implied volatility (IV)</strong>. In Black-Scholes model, volatility is treated as a constant. In practice, with a given price quote for an option, we can work backwards and derive the volatility constant perceived by the market. This is called implied volatility (IV). IV and price go hand in hand. Their relationship is almost linear.</p><figure class=align-center><img loading=lazy src=/imgs/opt/iv.png#center width=500></figure><p>In major events like earnings release, people anticipate large price movements, and such expectations are often priced into the options. As we can see below, even though Meta&rsquo;s Q3 2024 financials didn&rsquo;t meet investors&rsquo; expectations and its price suffered a large drop in the next trading day, put options can still lose money, because after the release there&rsquo;s no more uncertainty so demands vanish. This is called <strong>IV crush</strong>.</p><figure class=align-center><img loading=lazy src=/imgs/opt/iv-crush-meta.jpg#center width=600></figure><p>Second, with the formula, we are able to calculate its sensitivity to important factors by differentiating the formula. They are referred to as the &ldquo;greeks&rdquo;:</p><ul><li>sensitivity to stock price, <em><strong>delta</strong></em> $=\partial P_{\text{call}} / \partial s$,</li><li>stock price second derivative, <em><strong>gamma</strong></em> $=\partial^2P_{\text{call}} / \partial s^2$,</li><li>time decay, <em><strong>theta</strong></em> $=\partial P_{\text{call}} / \partial t$,</li><li>sensitivity to volatility, <em><strong>vega</strong></em> $=\partial P_{\text{call}} / \partial \sigma$,</li><li>sensitivity to interest rate, <em><strong>rho</strong></em> $=\partial P_{\text{call}} / \partial r$.</li></ul><p>A worth discussing greek is the <em><strong>delta</strong></em>, namely how much the option price will change when the underlying stock price changes by $1$ dollar. The formula is simply <em>delta</em> $= N(d_1)$, and for put options by equation (2) the delta is $N(d_1) - 1$. Since $N(x)$ is increasing, and strike $X$ appears as denominator in $d_1$, we see that deltas have a negative relationship with strikes. In other words, <strong>ITM options have large deltas, while OTM options have small deltas.</strong> That&rsquo;s part of the reason why in-the-money options are expensive while out-of-the-money ones are cheaper. If deltas were the same for all strikes, then it would only be optimal to trade far out-of-the-money options, which is unreasonable.</p><figure class=align-center><img loading=lazy src=/imgs/opt/delta.png#center width=500></figure><p>Suppose you bought an OTM call option. Its price will have slow response to the underlying stock price movement. However, as the price continues to increase so that it becomes an ITM option, your net profit/loss will become more volatile. For deep in-the-money calls, the delta is close to 1, so that 1 USD up or -1 USD down magnifies to +100 USD gain or -100 USD loss.</p><blockquote><p><details><summary markdown=span><strong>Derivation of delta</strong></summary>
Since the derivative of $\log(ax)$ is $(1/ax)\cdot a = 1/x$, we have
$$
\frac{\partial d_1}{\partial s_0} = \frac{\partial d_2}{\partial s_0} = \frac{1}{s_0\sigma\sqrt{T}}.
$$
With also
$$
d_1^2 - d_2^2 = (A+B)^2 - (A-B)^2 = 4AB = 2\log\left(\frac{e^{rT}s_0}{X}\right),
$$
the delta is
$$
\begin{align*}
\Delta &= \frac{\partial}{\partial s_0}\left( s_0 N(d_1) - e^{-rT} X\cdot N(d_2) \right) \newline
&= N(d_1) + s_0 n(d_1) \frac{\partial d_1}{\partial s_0} - e^{-rT} X n(d_2)
\frac{\partial d_2}{\partial s_0} \newline
&= N(d_1) + \frac{n(d_1)}{\sigma\sqrt{T}} \left( 1 - e^{(d_1^2-d_2^2)/2}\frac{X}{e^{rT}s_0} \right) \newline
&= N(d_1) + \frac{n(d_1)}{\sigma\sqrt{T}} \left( 1 - \frac{e^{rT}s_0}{X}\cdot\frac{X}{e^{rT}s_0}
\right) \newline
&= N(d_1).
\end{align*}
$$</details></p></blockquote><p>Another important greek is <em><strong>theta</strong></em>. The formula is
$$
\begin{align*}
\text{call theta} &= -\frac{s\cdot\sigma\cdot N'(d_1)}{2\sqrt{T}} - re^{-rT}X\cdot N(d_2)\newline
\text{put theta} &= -\frac{s\cdot\sigma\cdot N'(d_1)}{2\sqrt{T}} + re^{-rT}X\cdot N(-d_2)
\end{align*}
$$</p><p>As we can see from the plot below, holding expiration, interest rate and volatility constant, time decay is fastest for at-the-money options. This justifies short straddle, butterfly and condor strategies which essentially short thetas.</p><figure class=align-center><img loading=lazy src=/imgs/opt/theta.png#center width=500></figure><p>In general, if you&rsquo;re an intraday trader, you would want to buy deep in-the-money options, so that you can realize your profit sooner and don&rsquo;t have to wait long to fight against theta. If you do long-term trades, then you probably want to buy out-of-the-money ones, to not let short term gains and losses distract you.</p><p>Finally, here is the Python implementation for Black-Scholes formula.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>math</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>scipy.stats</span> <span class=k>as</span> <span class=nn>stats</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>N</span><span class=p>(</span><span class=n>x</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>stats</span><span class=o>.</span><span class=n>norm</span><span class=o>.</span><span class=n>cdf</span><span class=p>(</span><span class=n>x</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>delta</span><span class=p>(</span><span class=n>s</span><span class=p>,</span> <span class=n>X</span><span class=p>,</span> <span class=n>T</span><span class=p>,</span> <span class=n>r</span><span class=p>,</span> <span class=n>sigma</span><span class=p>,</span> <span class=n>typ</span><span class=o>=</span><span class=s1>&#39;call&#39;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>d1</span> <span class=o>=</span> <span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>log</span><span class=p>(</span><span class=n>s</span><span class=o>/</span><span class=n>X</span><span class=p>)</span> <span class=o>+</span> <span class=p>(</span><span class=n>r</span> <span class=o>+</span> <span class=n>sigma</span><span class=o>**</span><span class=mi>2</span><span class=o>/</span><span class=mi>2</span><span class=p>)</span><span class=o>*</span><span class=n>T</span><span class=p>)</span> <span class=o>/</span> <span class=p>(</span><span class=n>sigma</span> <span class=o>*</span> <span class=n>math</span><span class=o>.</span><span class=n>sqrt</span><span class=p>(</span><span class=n>T</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>N</span><span class=p>(</span><span class=n>d1</span><span class=p>)</span> <span class=k>if</span> <span class=n>typ</span> <span class=o>==</span> <span class=s1>&#39;call&#39;</span> <span class=k>else</span> <span class=n>N</span><span class=p>(</span><span class=n>d1</span><span class=p>)</span> <span class=o>-</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>theta</span><span class=p>(</span><span class=n>s</span><span class=p>,</span> <span class=n>X</span><span class=p>,</span> <span class=n>T</span><span class=p>,</span> <span class=n>r</span><span class=p>,</span> <span class=n>sigma</span><span class=p>,</span> <span class=n>typ</span><span class=o>=</span><span class=s1>&#39;call&#39;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>d1</span> <span class=o>=</span> <span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>log</span><span class=p>(</span><span class=n>s</span><span class=o>/</span><span class=n>X</span><span class=p>)</span> <span class=o>+</span> <span class=p>(</span><span class=n>r</span> <span class=o>+</span> <span class=n>sigma</span><span class=o>**</span><span class=mi>2</span><span class=o>/</span><span class=mi>2</span><span class=p>)</span><span class=o>*</span><span class=n>T</span><span class=p>)</span> <span class=o>/</span> <span class=p>(</span><span class=n>sigma</span> <span class=o>*</span> <span class=n>math</span><span class=o>.</span><span class=n>sqrt</span><span class=p>(</span><span class=n>T</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>d2</span> <span class=o>=</span> <span class=n>d1</span> <span class=o>-</span> <span class=n>sigma</span> <span class=o>*</span> <span class=n>math</span><span class=o>.</span><span class=n>sqrt</span><span class=p>(</span><span class=n>T</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>typ</span> <span class=o>==</span> <span class=s1>&#39;call&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>theta</span> <span class=o>=</span> <span class=o>-</span><span class=n>s</span> <span class=o>*</span> <span class=n>stats</span><span class=o>.</span><span class=n>norm</span><span class=o>.</span><span class=n>pdf</span><span class=p>(</span><span class=n>d1</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span> <span class=o>*</span> <span class=n>sigma</span> <span class=o>/</span> <span class=p>(</span><span class=mi>2</span> <span class=o>*</span> <span class=n>np</span><span class=o>.</span><span class=n>sqrt</span><span class=p>(</span><span class=n>T</span><span class=p>))</span> <span class=o>-</span> <span class=n>r</span> <span class=o>*</span> <span class=n>X</span> <span class=o>*</span> <span class=n>np</span><span class=o>.</span><span class=n>exp</span><span class=p>(</span><span class=o>-</span><span class=n>r</span> <span class=o>*</span> <span class=n>T</span><span class=p>)</span> <span class=o>*</span> <span class=n>N</span><span class=p>(</span><span class=n>d2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>elif</span> <span class=n>typ</span> <span class=o>==</span> <span class=s1>&#39;put&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>theta</span> <span class=o>=</span> <span class=o>-</span><span class=n>s</span> <span class=o>*</span> <span class=n>stats</span><span class=o>.</span><span class=n>norm</span><span class=o>.</span><span class=n>pdf</span><span class=p>(</span><span class=n>d1</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span> <span class=o>*</span> <span class=n>sigma</span> <span class=o>/</span> <span class=p>(</span><span class=mi>2</span> <span class=o>*</span> <span class=n>np</span><span class=o>.</span><span class=n>sqrt</span><span class=p>(</span><span class=n>T</span><span class=p>))</span> <span class=o>+</span> <span class=n>r</span> <span class=o>*</span> <span class=n>X</span> <span class=o>*</span> <span class=n>np</span><span class=o>.</span><span class=n>exp</span><span class=p>(</span><span class=o>-</span><span class=n>r</span> <span class=o>*</span> <span class=n>T</span><span class=p>)</span> <span class=o>*</span> <span class=n>N</span><span class=p>(</span><span class=o>-</span><span class=n>d2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>theta</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>black_scholes</span><span class=p>(</span><span class=n>s</span><span class=p>,</span> <span class=n>X</span><span class=p>,</span> <span class=n>T</span><span class=p>,</span> <span class=n>r</span><span class=p>,</span> <span class=n>sigma</span><span class=p>,</span> <span class=n>typ</span><span class=o>=</span><span class=s1>&#39;call&#39;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>d1</span> <span class=o>=</span> <span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>log</span><span class=p>(</span><span class=n>s</span><span class=o>/</span><span class=n>X</span><span class=p>)</span> <span class=o>+</span> <span class=p>(</span><span class=n>r</span> <span class=o>+</span> <span class=n>sigma</span><span class=o>**</span><span class=mi>2</span><span class=o>/</span><span class=mi>2</span><span class=p>)</span><span class=o>*</span><span class=n>T</span><span class=p>)</span> <span class=o>/</span> <span class=p>(</span><span class=n>sigma</span> <span class=o>*</span> <span class=n>math</span><span class=o>.</span><span class=n>sqrt</span><span class=p>(</span><span class=n>T</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>d2</span> <span class=o>=</span> <span class=n>d1</span> <span class=o>-</span> <span class=n>sigma</span> <span class=o>*</span> <span class=n>math</span><span class=o>.</span><span class=n>sqrt</span><span class=p>(</span><span class=n>T</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>price</span> <span class=o>=</span> <span class=n>s</span> <span class=o>*</span> <span class=n>N</span><span class=p>(</span><span class=n>d1</span><span class=p>)</span> <span class=o>-</span> <span class=n>X</span> <span class=o>*</span> <span class=n>math</span><span class=o>.</span><span class=n>exp</span><span class=p>(</span><span class=o>-</span><span class=n>r</span><span class=o>*</span><span class=n>T</span><span class=p>)</span> <span class=o>*</span> <span class=n>N</span><span class=p>(</span><span class=n>d2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>typ</span> <span class=o>==</span> <span class=s1>&#39;call&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>price</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>typ</span> <span class=o>==</span> <span class=s1>&#39;put&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>price</span> <span class=o>=</span> <span class=n>price</span> <span class=o>-</span> <span class=n>s</span> <span class=o>+</span> <span class=n>X</span> <span class=o>*</span> <span class=n>math</span><span class=o>.</span><span class=n>exp</span><span class=p>(</span><span class=o>-</span><span class=n>r</span><span class=o>*</span><span class=n>T</span><span class=p>)</span>  <span class=c1># put-call parity relationship</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>price</span>
</span></span></code></pre></td></tr></table></div></div><p>Now let&rsquo;s see how the Black-Scholes formula is derived. Since the Black-Scholes PDE will be converted to the heat equation in physics, as a first step we look at how the heat equation is derived.</p><h3 id=the-heat-equation-in-physics>The heat equation in physics<a hidden class=anchor aria-hidden=true href=#the-heat-equation-in-physics>#</a></h3><p>Let&rsquo;s derive the heat equation in one dimension. The heat equation describes how temperature will evolve as a function of time and space. Let $u(x, t)$ be temperature at location $x$ and time $t$. Note $x$ is a fixed position in space, not cumulative distance. We can choose either left (⬅) or right (➡) at $x$​ as a direction. Here we choose right.</p><p>The heat equation model consists of following components.</p><ol><li><p>Energy at $x$ is proportional to temperature at $x$:
$$
E \sim u\cdot dx \Longrightarrow\quad\frac{dE}{dt} \sim \frac{du}{dt}dx
$$</p></li><li><p>Flux is proportional to temperature change at opposite direction:
$$
q \sim -k\frac{du}{dx}
$$
This means heat flows from high temperature regions to low temperature regions. Note that we cannot determine the flux only with absolute value of temperature $|u|$. But if $u$ is increasing at $x$, it means the right of $x$ is hotter, the left is cooler, so heat will flow from right to left, and vice versa. The larger the difference, the larger the flux will be. if $u$ plateaus at $x$, there will be no flow of heat. We then get
$$
\frac{dq}{dx} \sim -k\frac{d^2u}{dx^2}
$$</p></li><li><p>The heat equation model says, at position $x$, change in energy over time is due to flux of heat around it:
$$
\frac{dE}{dt} \sim dq
$$
thus we get the heat equation (PDE)
$$
\boxed{\frac{du}{dt} = \alpha\frac{d^2u}{dx^2}}
$$</p></li></ol><p>While $u\equiv0$ is a solution, it might not satisfy the initial condition. To solve the equation, we decompose the function as $u(x, t) = \lambda(t)w(x)$, so that
$$
\frac{d\lambda}{dt}w(x) = \alpha\frac{d^2w}{dx^2}\lambda(t)
$$
Divide both sides by $\lambda(t)w(x)$, we get
$$
\frac{1}{\lambda}\frac{d\lambda}{dt} = \alpha\frac{d^2w}{dx^2}\frac{1}{w} \equiv c
$$
it is equal to some constant $c$ because the left side only involves variable $t$ and the right side only involves $x$.</p><p>Now, $\dot{\lambda}=c\lambda$, so $\lambda(t)$ will be an exponential function. $\ddot{w}=cw$, i.e. the second derivative of $w$ is itself, so $w$ will be some sinusoid wave. The solution to $u(x, t)$ is an exponential decay of sine waves, i.e. it is composed of something like
$$
u(x, t) = e^{-c_1t}\cdot\sin(c_2x).
$$
Note that the heat equation $\dot{u}=\nabla^2u$ is linear: if $u_1$ and $u_2$ are solutions to the heat equation, then so is $u=u_1+u_2$. In order for the solution to satisfy initial temperature shape $u(x, 0) = f(x)$ for some $f(x)$ on $[0, L]$, we represent $u(x,t)$ with an orthonormal basis $\{e_n\}_{n=1}^{\infty}$ in the function space $L^2$, specifically
$$
e_n(x) = \sqrt{\frac{2}{L}}\sin\left(\frac{n\pi x}{L}\right).
$$
The general solution is
$$
u(x, t) = \sum_{n=1}^\infty \langle f, e_n\rangle e_n \cdot e^{-\frac{n^2\pi^2\alpha t}{L^2}}
$$
where
$$
\langle f, e_n\rangle = \int_0^Lf(x)e_n(x)dx.
$$
Finally, we can easily extend the heat equation to 3d, $\dot{u}=\alpha\nabla^2 u$.</p><h3 id=the-black-scholes-equation>The Black-Scholes equation<a hidden class=anchor aria-hidden=true href=#the-black-scholes-equation>#</a></h3><p>Let $u(x, t)$ denote the value of a call option at stock price $x$ and time $t$​. With the following assumptions:</p><ol><li>the stock price $x$ is a stochastic process following the geometric brownian motion
$$
dx = x\bigg(\mu dt + \sigma dW\bigg)
$$</li><li>the risk-free rate $r$ is constant,</li><li>the volatility $\sigma$ of the stock is constant,</li></ol><p>the option price $u(x, t)$ satisfies the following stochastic partial differential equation (SPDE):
$$
\boxed{\frac{\partial u}{\partial t}=ru-rx\cdot u_x-\frac{1}{2}\sigma^2x^2\cdot u_{xx}}
$$</p><h3 id=derivation-of-the-black-scholes-equation>Derivation of the Black-Scholes equation<a hidden class=anchor aria-hidden=true href=#derivation-of-the-black-scholes-equation>#</a></h3><p><strong>Ito&rsquo;s lemma</strong> If $x$ is a stochastic process such that $dx = \mu dt +\sigma dW$, and $f$ is a twice-differentiable scalar function, then the differential of $f(x, t)$ is given by
$$
df = \bigg(f_t+\mu f_x+\frac{\sigma^2}{2}f_{xx}\bigg)dt + \sigma f_xdW
$$
It can be derived from the taylor expansion of $f(x, t)$ with the fact that $dt^2$, $dtdW$ and higher order terms all goes to $0$ and $dW^2=dt$.</p><p>Using the Ito&rsquo;s lemma for our stock price $x$, we get
$$
du = \left(u_t + \mu x\cdot u_x + \frac{\sigma^2}{2}x\cdot u_{xx}\right)dt + \sigma x\cdot u_xdW
$$
Now construct a portfolio that shorts on the call $u$ and longs for $u_x$ shares of stocks, i.e. a <strong>covered call</strong>:
$$
H = -u + u_x\cdot x
$$
Over $dt$, the total profit or loss is
$$
\begin{aligned}
dH &= -du + u_xdx\
&= -du + u_x\cdot x\left(\mu dt + \sigma dW\right)\
&= \left(-u_t - \frac{\sigma^2}{2}x^2\cdot u_{xx}\right)dt
\end{aligned}
$$
The $dW$ term cancels out, leaving with no uncertainty, so the return must equal risk free rate (<em>arbitrage free assumption</em>):
$$
\begin{aligned}
dH &= H\cdot rdt\
&= (-ru + rx\cdot u_x),dt
\end{aligned}
$$
Rearrange we get the Black-Scholes equation
$$
u_t = ru - rx\cdot u_x - \frac{\sigma^2}{2}x^2\cdot u_{xx}
$$</p><h3 id=solving-the-black-scholes-equation>Solving the Black-Scholes equation<a hidden class=anchor aria-hidden=true href=#solving-the-black-scholes-equation>#</a></h3><p>A series of change of variables can transform the Black-Scholes equation into the <em>heat equation</em>:</p><ol><li>set $y = \log(x)$ to convert the (multiplicative) geometric brownian motion into additive one.</li><li>set $\tau = T - t$ to align with the diffusion direction in heat equation.</li><li>add an exponential term to $u(x, t)$​ to account for the exponential decay in the solution of heat equation. Set $w(y, \tau) = e^{\alpha\tau}u(x, t)$, where $\alpha=r - \frac{1}{2}\sigma^2$.</li></ol><p>Under these, the equation becomes
$$
w_t = \frac{1}{2}\sigma^2w_{yy}
$$
which is the heat equation that we have discussed above. Separation of variables and Fourier transforms can be used to solve the equation analytically. Once the solution is found, $u(x, t)$ can be obtained by reversing the change of variables:
$$
u(x, t) = e^{-\alpha\tau}w(y, \tau)
$$</p><h2 id=is-the-black-scholes-model-realistic>Is the Black-Scholes model realistic?<a hidden class=anchor aria-hidden=true href=#is-the-black-scholes-model-realistic>#</a></h2><p>There has been some criticism of the Black-Scholes model
<span class=hugo-cite-intext itemprop=citation>(<span class=hugo-cite-group>
<a href=#haug2011option><span class=visually-hidden>Citation: </span><span itemprop=author itemscope itemtype=https://schema.org/Person><meta itemprop=givenName content="Espen Gaarder"><span itemprop=familyName>Haug</span></span> & <span itemprop=author itemscope itemtype=https://schema.org/Person><meta itemprop=givenName content="Nassim Nicholas"><span itemprop=familyName>Taleb</span></span>, <span itemprop=datePublished>2011</span></a><span class=hugo-cite-citation>
<span itemscope itemtype=https://schema.org/Article data-type=article><span itemprop=author itemscope itemtype=https://schema.org/Person><span itemprop=familyName>Haug</span>, <meta itemprop=givenName content="Espen Gaarder">E.</span> & <span itemprop=author itemscope itemtype=https://schema.org/Person><span itemprop=familyName>Taleb</span>, <meta itemprop=givenName content="Nassim Nicholas">N.</span>
 
(<span itemprop=datePublished>2011</span>).
 <span itemprop=name>Option traders use (very) sophisticated heuristics, never the black–scholes–merton formula</span>.<i>
<span itemprop=about>Journal of Economic Behavior & Organization</span>, 77(2)</i>. <span itemprop=pagination>97–106</span>.</span>
</span></span>)</span>
. Empirically, numbers given by the Black-Scholes formula match closely to actual option prices, yet are always somewhat higher than the actual ones. This is because real markets differ from core model assumptions:</p><ol><li><p>Continuity assumption. In the Black-Scholes model, stock prices are assumed to follow geometric brownian motion. In reality, it&rsquo;s never the case. First, stock prices have discrete jumps in part due to limited trading hours. In the US market, stocks are traded from 9:30 AM to 4:00 PM US eastern time. Accumulated news and sentiments can result in next day&rsquo;s open price to differ sharply from yesterday&rsquo;s close price. Even if there are pre-market and post-market trades, options however do not enjoy extra trading hours and are only traded in normal trading hours.</p><figure class=align-center><img loading=lazy src=/imgs/opt/goog.jpg#center alt="stock prices have jumps" width=600><figcaption><p>stock prices have jumps</p></figcaption></figure><p>But most importantly, stock prices are not random walks that are governed by few parameters. Sometimes the price will drift to some interval and then get stuck there for a long time, other times it will have strong momentum to go for a single direction. Different stocks exhibit different patterns, and all the patterns are different from purely random walks. Behind the scenes, prices are formed by human demand and supply, by strategic interactions among market players, by their expectations, intentions, reactions and emotions. Predicting or characterizing stock price is a very challenging problem. Because real stock prices don&rsquo;t have the nice properties of geometric brownian motion, and they are harder to predict, it is harder to make a return on options, so premiums will be lower than what the model predicts.</p></li><li><p>Liquidity assumption. The option pricing model doesn&rsquo;t take liquidity into account. In other word, it assumes that the market is liquid. This again is not realistic. Since options are derivative products with high risks, trading volume is far less than their underlying stocks and ETFs. Trades can occur very sparsely during a trading day, especially for deep OTM/ITM ones and options with long expirations. In such cases, the bid-ask spread can become a non-negligible factor to your profit calculation.</p></li></ol><p>Nonetheless, the Black-Scholes model provides a very useful framework for thinking about options, for example implied volatility and the greeks.</p><h2 id=closing-remarks>Closing Remarks<a hidden class=anchor aria-hidden=true href=#closing-remarks>#</a></h2><p>In this post we discussed several common option trading strategies. We showed how puts and calls can be combined to encounter various market situations. We also discussed the Black-Scholes model in detail, and showed how its properties can help us choose options. But no single strategy can give you persistent profits. For example, while selling puts/calls and capturing time decays might seem a good idea to generate stable cash flows, a large unexpected move can wipe out your gains accumulated over a long time. The most important challenge for trading remains about predicting the timing, direction and scale of future stock price movements for as accurate as possible.</p><h2 id=references>References<a hidden class=anchor aria-hidden=true href=#references>#</a></h2><section class=hugo-cite-bibliography><div style=margin-bottom:2pt id=black-scholes>◎
<span itemscope itemtype=https://schema.org/Article data-type=article><span itemprop=author itemscope itemtype=https://schema.org/Person><span itemprop=familyName>Black</span>, <meta itemprop=givenName content="Fischer">F.</span> & <span itemprop=author itemscope itemtype=https://schema.org/Person><span itemprop=familyName>Scholes</span>, <meta itemprop=givenName content="Myron">M.</span>
 
(<span itemprop=datePublished>1973</span>).
 <span itemprop=name>The pricing of options and corporate liabilities</span>.<i>
<span itemprop=about>Journal of political economy</span>, 81(3)</i>. <span itemprop=pagination>637–654</span>.</span></div><div style=margin-bottom:2pt id=haug2011option>◎
<span itemscope itemtype=https://schema.org/Article data-type=article><span itemprop=author itemscope itemtype=https://schema.org/Person><span itemprop=familyName>Haug</span>, <meta itemprop=givenName content="Espen Gaarder">E.</span> & <span itemprop=author itemscope itemtype=https://schema.org/Person><span itemprop=familyName>Taleb</span>, <meta itemprop=givenName content="Nassim Nicholas">N.</span>
 
(<span itemprop=datePublished>2011</span>).
 <span itemprop=name>Option traders use (very) sophisticated heuristics, never the black–scholes–merton formula</span>.<i>
<span itemprop=about>Journal of Economic Behavior & Organization</span>, 77(2)</i>. <span itemprop=pagination>97–106</span>.</span></div></section></div><footer class=post-footer><ul class=post-tags><li><a href=https://lifei.ai/tags/tag/>tag</a></li></ul><nav class=paginav><a class=next href=https://lifei.ai/posts/2024-02-12-vision-models/><span class=title>Next »</span><br><span>Vision Models</span></a></nav><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share Options Trading and the Black-Scholes Model on x" href="https://x.com/intent/tweet/?text=Options%20Trading%20and%20the%20Black-Scholes%20Model&amp;url=https%3a%2f%2flifei.ai%2fposts%2f2024-11-26-options%2f&amp;hashtags=tag"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Options Trading and the Black-Scholes Model on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2flifei.ai%2fposts%2f2024-11-26-options%2f&amp;title=Options%20Trading%20and%20the%20Black-Scholes%20Model&amp;summary=Options%20Trading%20and%20the%20Black-Scholes%20Model&amp;source=https%3a%2f%2flifei.ai%2fposts%2f2024-11-26-options%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Options Trading and the Black-Scholes Model on reddit" href="https://reddit.com/submit?url=https%3a%2f%2flifei.ai%2fposts%2f2024-11-26-options%2f&title=Options%20Trading%20and%20the%20Black-Scholes%20Model"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Options Trading and the Black-Scholes Model on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2flifei.ai%2fposts%2f2024-11-26-options%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Options Trading and the Black-Scholes Model on whatsapp" href="https://api.whatsapp.com/send?text=Options%20Trading%20and%20the%20Black-Scholes%20Model%20-%20https%3a%2f%2flifei.ai%2fposts%2f2024-11-26-options%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Options Trading and the Black-Scholes Model on telegram" href="https://telegram.me/share/url?text=Options%20Trading%20and%20the%20Black-Scholes%20Model&amp;url=https%3a%2f%2flifei.ai%2fposts%2f2024-11-26-options%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Options Trading and the Black-Scholes Model on ycombinator" href="https://news.ycombinator.com/submitlink?t=Options%20Trading%20and%20the%20Black-Scholes%20Model&u=https%3a%2f%2flifei.ai%2fposts%2f2024-11-26-options%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentcolor" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></li></ul></footer></article></main><footer class=footer><span>&copy; 2024 <a href=https://lifei.ai/>Fei Li</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"auto"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>